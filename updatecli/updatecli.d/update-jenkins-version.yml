scms:
  github:
    kind: github
    spec:
      user: '{{ .github.user }}'
      email: '{{ .github.email }}'
      owner: '{{ .github.owner }}'
      repository: '{{ .github.repository }}'
      branch: '{{ .github.branch }}'
      username: '{{ .github.username }}'
      token: '{{ requiredEnv .github.token }}'
sources:
  jenkins:
    name: Get Jenkins Weekly Version
    kind: jenkins
    spec:
      release: stable
      github:
        token: '{{ requiredEnv .github.token }}'
        username: '{{ .github.username }}'
  current-jenkins:
    name: Get Current Jenkins Version
    kind: shell
    spec:
      command: pwsh -NoProfile -File {{ requiredEnv "GITHUB_WORKSPACE" }}/updatecli/current-jenkins.ps1 -JenkinsfilePath Jenkinsfile
conditions:
  jenkins:
    name: Test if Jenkins Stable published
    kind: maven
    sourceid: jenkins
    spec:
      url: repo.jenkins-ci.org
      repository: releases
      groupId: org.jenkins-ci.main
      artifactId: jenkins-war
targets:
  jenkins:
    name: Update Jenkins Version
    sourceid: jenkins
    scmid: github
    kind: shell
    spec:
      command: pwsh -NoProfile -File {{ requiredEnv "GITHUB_WORKSPACE" }}/updatecli/update-jenkins.ps1 -JenkinsfilePath Jenkinsfile -NewVersion
pullrequests:
  jenkins:
    title: Bump Jenkins Version from {{ source "current-jenkins" }} to {{ source "jenkins" }}
    kind: github
    scmid: github
    targets:
    - jenkins
    spec:
      labels:
      - dependencies
      automerge: true
      mergemethod: squash
      usetitleforautomerge: true